# 字跑大师 (Word Runner) - 项目文档

**当前版本**: v2.8.6 (2026-02-13)

## 📖 项目简介
《字跑大师》是一款结合了跑酷玩法与汉字学习教育功能的 Web 游戏。玩家操控角色在三条跑道上奔跑，通过识别任务拼音，收集对应的正确汉字，同时躲避障碍物和干扰项（错误汉字）。游戏旨在通过趣味互动帮助玩家巩固拼音与汉字的对应关系。

## 🛠 技术栈
*   **核心语言**: HTML5, CSS3, Vanilla JavaScript (ES6+)
*   **渲染引擎**: Canvas API (2D Context)
*   **音频**: Web Audio API (合成音效 + 语音播报)
*   **存储**: LocalStorage (用于保存最高分等简单数据，目前主要依赖内存)
*   **依赖**: 无外部框架 (No React/Vue/Phaser)，纯原生实现，保持轻量级。

## 🎮 游戏核心规则

### 1. 胜利条件 (通关)
满足以下**任一**条件即可通关当前关卡：
*   **累计正确**: 收集满 **9个** 正确汉字。
*   **连续正确**: 连续收集 **4个** 正确汉字（连击）。

### 2. 失败条件 (Game Over)
满足以下**任一**条件游戏结束：
*   **生命耗尽**: 初始 **3点** 生命值，扣完即死。
*   **连续错误**: 连续收集 **4个** 错误项（干扰项）。
*   **超时**: 关卡倒计时结束后未完成任务。

### 3. 得分机制
*   **正确汉字**: 基础分(100) * 连击倍率 (最高5倍)。
*   **躲避障碍**: +10分 (跳过障碍物)。
*   **通关奖励**: 基础分(1000) + 剩余时间奖励 + 连胜关卡奖励。

### 4. 惩罚机制
*   **撞击障碍物**: -1 生命值, 连击清零。
*   **收集错误字**: -0.5 生命值, 连击清零, 累计错误连击。

### 5. 物品生成逻辑
*   **正确项 (Correct)**:
    *   **唯一性**: 每关只生成**一个**固定的正确汉字（对应当前任务拼音）。
    *   **低保机制**: 如果时间紧迫且任务未完成，会强制提高正确项的生成概率。
*   **干扰项 (Wrong)**:
    *   **排他性**: 绝不生成与当前拼音相同的其他汉字（避免混淆）。
    *   **同音过滤**: 严格过滤同音字。
*   **障碍物 (Obstacle)**:
    *   **类型**: 红色路障、施工围栏（带闪烁灯和警告标志）。

## 🕹 操作控制
*   **移动**: `A` / `D` 键 或 `←` / `→` 方向键 (切换跑道)。
*   **跳跃**: `W` / `↑` 方向键。
*   **开始/暂停**: 界面按钮点击。

## 🎨 视觉与体验设计 (UI/UX)

### 1. 跑道视效
*   **透视**: 采用伪3D透视效果（消失点位于屏幕中央偏上）。
*   **动态收缩**: 跑道底部（角色位置）宽度收缩至 75%，顶部保持 100%，以在保持透视感的同时确保角色在左右跑道时不被屏幕边缘裁剪。
*   **物品轨迹**: 物品沿曲线插值移动（v2.8.5 逻辑，保留了跑道收缩的视觉特性）。

### 2. HUD (抬头显示)
*   **任务环**: 位于屏幕上方中央，显示当前拼音任务。
    *   **进度显示**: 外环分为9格，每收集一个正确字点亮一格。
    *   **完成动画**: 任务完成后，光环高亮闪烁，给予强烈视觉反馈。
*   **连击提示**:
    *   **位置**: 位于任务环正下方，避免遮挡核心视线。
    *   **动画**: 出现后 **0.8秒** 自动向上飘动并淡出消失，不干扰游戏。
*   **信息栏**: 包含生命值(红心)、倒计时、当前分数、关卡等级。

### 3. 角色与动画
*   **火柴人风格**: 这不是简单的线条，而是带有发光关节和肢体粗细变化的动态角色。
*   **动作**: 包含 奔跑（手臂大幅摆动）、跳跃（双腿蜷缩）、撞击反馈。
*   **昵称显示**: 头顶显示玩家昵称，带霓虹阴影。

### 4. 反馈系统
*   **特效**: 收集/撞击时有粒子爆炸效果。
*   **音效**:
    *   **合成音效**: 跳跃、撞击、升级、得分均有不同频率的合成音效。
    *   **语音朗读**: 每次收集到正确汉字，会朗读该汉字的发音（使用 `SpeechSynthesisUtterance`）。只有正确项会发声，强化记忆。

## 🐛 已修复问题记录
1.  **跑道宽度问题**: 修复了角色在左右跑道边缘被裁剪的问题（通过 `trackX` 的 `shrinkFactor` 逻辑）。
2.  **连击遮挡**: 调整了连击提示的位置和消失时间，解决了遮挡任务进度环的问题。
3.  **物品轨迹**: 曾尝试改为直线轨迹，后根据需求回滚至曲线收缩逻辑以匹配跑道视觉。
4.  **发音Bug**: 修复了收集正确字不发音的问题。
5.  **通关流程**: 优化了通关后的体验，先播放光环动画，延迟 1.5秒 再弹出结算窗，保持游戏沉浸感。
6.  **控制面板**: 增加了开发者控制面板（`workbench.html`），支持调整关卡数据源和规则。

## 📁 文件结构
*   `index.html`: 主游戏入口，包含所有游戏逻辑、渲染和样式（单文件架构）。
*   `workbench.html`: 游戏配置与调试工具。
*   `README.md`: 项目文档（本文）。

---
*Created by Antigravity Agent*
